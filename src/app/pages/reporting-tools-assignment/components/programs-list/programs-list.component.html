<div *ngIf="{ programsDetails: programsDetails$ | async, 
  translations: translations$ | async, } as params">
  <div class="w-100">
    <mat-form-field class="w-25">
      <mat-label>Search </mat-label>
      <mat-icon matPrefix>search</mat-icon>
      <input matInput (keyup)="searchProgram($event)" />
    </mat-form-field>
  </div>
  <div *ngIf="params?.programsDetails" class="table-container">
    <table class="table table-striped table-bordered mat-elevation-z1">
      <thead class="custom-header-bg">
        <tr>
          <th style="width: 20px">{{ params.translations['SN'] || 'SN' }}</th>
          <th>{{ params?.translations['Dataset'] || 'Dataset' }}</th>

          <th>{{ params?.translations['Reporting Facilities'] || 'Reporting Facilities' }}</th>
          <th>{{ params?.translations['Actions'] || 'Actions' }}</th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="
            let program of params?.programsDetails?.programs;
            let count = index
          "
        >
          <td>
            {{
              count + 1 + (params?.programsDetails?.pager?.page - 1) * pageSize
            }}
          </td>
          <td>
            {{ program?.name }}
          </td>
          <td>
            {{ program?.organisationUnits }}
          </td>
          <td>
            <div class="d-flex justify-content-end">
              <div
                style="font-size: 0.8rem; width: 35%"
                *ngIf="program?.hasPendingRequest"
              >
                <mat-chip-list>
                  <mat-chip>
                    {{ program?.timeSinceResponseSent }}
                  </mat-chip>
                </mat-chip-list>
              </div>

              <div style="width: 65%">
                <div class="w-100 d-flex justify-content-end">
                  <div style="width: 40%">
                    <button
                      mat-stroked-button
                      [ngClass]="{
                        'disabled-button': program?.hasPendingRequest
                      }"
                      (click)="onRequestProgram($event, program)"
                      class="action-btns"
                    >
                      {{
                        params?.translations[(program?.hasPendingRequest ? 'View' : 'Request')]
                          || (program?.hasPendingRequest ? 'View' : 'Request')
                      }}
                    </button>
                  </div>
                  <div style="width: 60%">
                    <div class="w-100 d-flex justify-content-end">
                      <button
                        color="warn"
                        mat-flat-button
                        (click)="onCancelAll($event, program, false)"
                        *ngIf="program?.hasPendingRequest"
                      >
                        {{ params?.translations['Cancel'] || 'Cancel' }}
                      </button>
                    </div>
                    <!-- <div class="w-100" *ngIf="dataRow?.hasPendingRequest">
                        <app-rejected-form-requests-summary
                          [keys]="dataRow?.keys"
                        ></app-rejected-form-requests-summary>
                      </div> -->
                    <div
                      class="w-100 mt-2"
                      *ngIf="
                        showConfirmButtons && program.id === currentProgram?.id
                      "
                    >
                      <div class="w-100">
                        <mat-form-field class="w-100">
                          <mat-label>{{
                            params?.translations['Provide reason for cancelling form request'] || 'Provide reason for cancelling form request'
                          }}</mat-label>
                          <textarea
                            [(ngModel)]="reasonForCancellingRequest"
                            required
                            matInput
                            placeholder="{{ 'E.g' }} {{
                              params?.translations['Nilituma kimakosa'] || 'Nilituma kimakosa'
                            }}"
                          ></textarea>
                        </mat-form-field>
                      </div>
                      <div class="w-100">
                        <button
                          color="warn"
                          (click)="onUnConfirm($event)"
                          mat-flat-button
                          class="ml-2"
                        >
                          {{ params?.translations['Cancel'] || 'Cancel' }}
                        </button>
                        <button
                          mat-stroked-button
                          [disabled]="!reasonForCancellingRequest"
                          class="ml-2 btn-success"
                          (click)="onCancelAll($event, currentProgram, true)"
                        >
                          {{ params?.translations['Confirm'] || 'Confirm' }}
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
                <div
                  class="w-100"
                  *ngIf="updating && program.id === currentProgram?.id"
                >
                  <mat-progress-bar mode="indeterminate"></mat-progress-bar>
                </div>
              </div>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <div class="pagination d-flex justify-content-end">
      <mat-paginator
        [length]="params?.programsDetails?.pager?.total"
        aria-label="Select page"
        [pageSize]="pageSize"
        [pageIndex]="pageIndex"
        [pageSizeOptions]="pageSizeOptions"
        (page)="getProgramsList($event)"
      >
      </mat-paginator>
    </div>
  </div>
  <mat-progress-bar
    mode="indeterminate"
    *ngIf="!params?.programsDetails"
  ></mat-progress-bar>
</div>
