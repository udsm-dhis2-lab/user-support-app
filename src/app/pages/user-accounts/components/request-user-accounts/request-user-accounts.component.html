<div 
*ngIf="{
  configurations: configurations$ | async,
  translations: translations$ | async
} as params"
class="new-user-request-container">
  <div class="col-12 d-flex align-items-center mb-3">
    <button mat-flat-button color="primary" routerLink="/user-accounts/list">
      <mat-icon>arrow_back</mat-icon>
      <span class="ml-2">{{ params?.translations['Back to Request List'] || 'Back to Request List' }}</span>
    </button>
    <div class="ml-3 h5 report-title">
      {{ params?.translations['User Account Request'] || 'User Account Request' }}
    </div>
  </div>

  <div class="loading-overlay" *ngIf="saving">
    <div class="text-center">
      <div>{{ params?.translations['Sending request'] || 'Sending request' }}...</div>
      <div class="mt-3 d-flex justify-content-center w-100">
        <mat-spinner diameter="50" strokeWidth="2"></mat-spinner>
      </div>
    </div>
  </div>
  <div class="p-3" *ngIf="pageReady">
    <div class="row" *ngIf="!readyToSend">
      <div class="col-md-4 col-sx-12">
        <div>
          <div class="h5">{{ params?.translations['Demographic'] || 'Demographic' }}</div>
          <app-form
            *ngIf="formFields"
            [fields]="formFields"
            (formUpdate)="onUpdateDemographicForm($event)"
          ></app-form>
        </div>
      </div>
      <div class="col-md-8">
        <div class="row">
          <div class="col-md-6 col-sx-12">
            <div>
              <div class="h5">{{ params?.translations['Data entry'] || 'Data entry' }}</div>
              <ngx-dhis2-org-unit-filter
                *ngIf="showOrgUnit"
                [orgUnitFilterConfig]="orgUnitFilterConfigForDataEntry"
                [selectedOrgUnitItems]="selectedOrgUnitItemsForDataEntry"
                (orgUnitUpdate)="onOrgUnitUpdate($event, 'ENTRY')"
              >
              </ngx-dhis2-org-unit-filter>
            </div>
          </div>
          <div class="col-md-6 col-sx-12">
            <div>
              <div class="h5">{{ params?.translations['Report'] || 'Report' }}</div>
              <ngx-dhis2-org-unit-filter
                *ngIf="showOrgUnit"
                [orgUnitFilterConfig]="orgUnitFilterConfigForReport"
                [selectedOrgUnitItems]="selectedOrgUnitItemsForReport"
                (orgUnitUpdate)="onOrgUnitUpdate($event, 'REPORT')"
              >
              </ngx-dhis2-org-unit-filter>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-12 mt-4">
            <div class="h5">{{ params?.translations['Access'] || 'Access' }}</div>
            <app-form
              [fields]="accessFormFields"
              [isFormHorizontal]="true"
              (formUpdate)="onUpdateAccessControlForm($event)"
            ></app-form>
          </div>
        </div>
      </div>
    </div>
    <div class="w-100" *ngIf="readyToSend">
      <table class="table">
        <thead>
          <tr>
            <th>{{ params?.translations['SN'] || 'SN' }}</th>
            <th>{{ params?.translations['First name'] || 'First name' }}</th>
            <!-- <th>Middle name</th> -->
            <th>{{ params?.translations['Last name'] || 'Last name' }}</th>
            <th>{{ params?.translations['Email'] || 'Email' }}</th>
            <th>{{ params?.translations['Phone number'] || 'Phone number' }}</th>
            <th>{{ params?.translations['Option'] || 'Option' }}</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of formDataToStoreLocally; let count = index">
            <td>
              {{ count + 1 }}
            </td>
            <td>
              {{ user?.firstName }}
            </td>
            <!-- <td>
              {{ user?.middleName }}
            </td> -->
            <td>
              {{ user?.lastName }}
            </td>
            <td>
              {{ user?.email }}
            </td>
            <td>
              {{ user?.phoneNumber }}
            </td>
            <td>
              <button
              *ngIf="readyToSend"
              mat-stroked-button
              color="primary"
              (click)="onEdit(user?.id)"
              class="ml-2"
            >
              {{ params?.translations['Edit'] || 'Edit' }}
            </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <p class="text-right" *ngIf="shouldConfirm">
      {{ params?.translations['Please confirm'] || 'Please confirm' }}
    </p>
    <div class="row d-flex justify-content-end mt-2">
      <!-- [disabled]="!isDemographicFormValid || !isAccessControlFormValid" -->
      <!-- <button
        *ngIf="!readyToSend"
        [disabled]="prevIndex === 0"
        mat-stroked-button
        color="primary"
        (click)="onPrev($event)"
      >
        Previous
      </button> -->
      <button
        *ngIf="!readyToSend && !onEditing"
        mat-flat-button
        [disabled]="
          !isAccessControlFormValid ||
          selectedOrgUnitItemsForDataEntry?.length == 0 ||
          selectedOrgUnitItemsForReport?.length == 0 ||
          !isDemographicFormValid
        "
        color="primary"
        class="ml-2"
        (click)="onNext($event)"
      >
        {{ params?.translations['Add'] || 'Add' }}
    </button>
      <button
        *ngIf="onEditing"
        mat-flat-button
        color="primary"
        class="ml-2"
        (click)="onSubmit($event)"
      >
        {{ params?.translations['Save'] || 'Save' }}
    </button>
      <button
        *ngIf="!readyToSend"
        [disabled]="formDataToStoreLocally?.length === 0 || formData?.firstName && !onEditing"
        mat-flat-button
        color="primary"
        class="ml-2"
        (click)="onFinish($event)"
      >
        {{ params?.translations['Finish request'] || 'Finish request' }}
      </button>
      <button
        *ngIf="readyToSend"
        mat-flat-button
        color="primary"
        (click)="backtoRequest($event)"
      >
        {{ params?.translations['Back to request'] || 'Back to request' }}
      </button>
    </div>
    <div class="row d-flex justify-content-end mt-2">
      <button *ngIf="!readyToSend" mat-stroked-button (click)="onClear($event)">
        {{ params?.translations['Clear'] || 'Clear' }}
      </button>
      <button
        *ngIf="readyToSend"
        mat-flat-button
        color="primary"
        [disabled]="!readyToSend"
        (click)="onSend($event, params?.configurations)"
        class="ml-2"
      >
        {{ params?.translations['Send'] || 'Send' }}
      </button>
    </div>
  </div>
</div>
