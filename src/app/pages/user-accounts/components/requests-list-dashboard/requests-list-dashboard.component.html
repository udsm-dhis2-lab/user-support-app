<div
  class="requests-list-container"
  *ngIf="{ allDataForUserSupport: allDataForUserSupport$ | async } as params"
>
  <div class="loading-overlay" *ngIf="saving">
    <div class="text-center">
      <div>{{ 'Saving' | translate }} ....</div>
      <div class="mt-3 d-flex justify-content-center w-100">
        <mat-spinner diameter="50" strokeWidth="2"></mat-spinner>
      </div>
    </div>
  </div>
  <mat-progress-bar
    mode="indeterminate"
    *ngIf="!params?.allDataForUserSupport"
  ></mat-progress-bar>
  <!-- {{ params?.allDataForUserSupport?.data | json }} -->
  <div class="w-100 p-3" style="overflow: auto">
    <table class="table table-striped table-bordered mat-elevation-z1">
      <thead class="custom-header-bg">
        <tr>
          <th style="width: 15px">{{ 'SN' | translate }}</th>
          <th>{{ 'Request' | translate }}</th>
          <th>{{ 'Date' | translate }}</th>
          <th style="width: 300px">{{ 'Actions' | translate }}</th>
        </tr>
      </thead>
      <tbody *ngIf="params?.allDataForUserSupport">
        <ng-container
          *ngIf="
            (
              params?.allDataForUserSupport?.data
              | FilterFormRequests : 'status' : 'REJECTED' : currentUser?.id
            )?.length > 0
          "
        >
          <ng-container
            *ngFor="
              let dataRow of params?.allDataForUserSupport?.data
                | FilterFormRequests : 'status' : 'REJECTED' : currentUser?.id;
              let count = index
            "
          >
            <tr>
              <td>
                {{ count + 1 }}
              </td>
              <td>
                <div [innerHTML]="dataRow?.message?.message"></div>
              </td>
              <td>
                {{ dataRow?.timeSinceResponseSent }}
              </td>
              <td class="d-flext justify-content-end">
                <button
                  *ngIf="!dataRow?.type"
                  mat-flat-button
                  (click)="onToggleDetails($event, dataRow)"
                >
                  {{ 'View details' | translate }}
                </button>
                <!-- <button mat-button class="ml-2">
                  <mat-icon title="Delete Request">delete</mat-icon>
                </button> -->
              </td>
            </tr>
            <tr *ngIf="viewMoreDetails[dataRow?.id]">
              <td colspan="100%">
                <table class="table ml-4 mr-5">
                  <thead>
                    <tr>
                      <th>{{ 'SN' | translate }}</th>
                      <th>{{ 'Names' | translate }}</th>
                      <th>{{ 'Phone' | translate }}</th>
                      <th>{{ 'Username' | translate }}</th>
                      <th>{{ 'Password' | translate }}</th>
                      <th>{{ 'Status' | translate }}</th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody>
                    <ng-container
                      *ngFor="let user of dataRow?.payload; let count = index"
                    >
                      <tr
                        [ngClass]="{
                          'created-user': user?.status == 'CREATED',
                          'approved-user': user?.status == 'APPROVED'
                        }"
                      >
                        <td>
                          {{ count + 1 }}
                        </td>
                        <td>
                          {{ user?.firstName + ' ' + user?.surname }}
                        </td>
                        <td>
                          {{ user?.phoneNumber }}
                        </td>
                        <td>
                          {{ user?.username ? user?.username : '-' }}
                        </td>
                        <td>
                          {{ user?.password ? user?.username : '-' }}
                        </td>
                        <td>
                          {{ user?.status }}
                        </td>
                        <td>
                          <p class="w-100"></p>
                          <button
                            mat-stroked-button
                            [disabled]="user?.status"
                            (click)="
                              onRemoveUser(
                                $event,
                                user,
                                dataRow,
                                itemsToConfirm[user?.referenceId] ===
                                  user?.referenceId
                                  ? true
                                  : false
                              )
                            "
                          >
                            <mat-icon
                              *ngIf="!itemsToConfirm[user?.referenceId]"
                              title="Remove this user"
                              >delete</mat-icon
                            >
                            <span *ngIf="itemsToConfirm[user?.referenceId]">{{
                              'Confirm' | translate
                            }}</span>
                          </button>
                        </td>
                      </tr>
                    </ng-container>
                  </tbody>
                </table>
              </td>
            </tr>
          </ng-container>
        </ng-container>
        <ng-container
          *ngIf="
            (
              params?.allDataForUserSupport?.data
              | FilterFormRequests : 'status' : 'REJECTED' : currentUser?.id
            )?.length == 0
          "
        >
          <tr>
            <td colspan="100%">
              <div class="alert alert-warning" role="alert">
                {{ 'No request available' | translate }}
              </div>
            </td>
          </tr>
        </ng-container>
      </tbody>
    </table>
  </div>
  <div
    mat-dialog-actions
    class="d-flex justify-content-end"
    *ngIf="
      currentUser?.keyedAuthorities['ALL'] ||
      currentUser?.keyedAuthorities['US_USER_ACCOUNT_REQUEST']
    "
  >
    <!-- <button
      mat-stroked-button
      [matMenuTriggerFor]="menu"
      style="
        box-sizing: border-box;
        font-family: Roboto, sans-serif;
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
        cursor: pointer;
        text-decoration: none;
        font-size: inherit;
        font-weight: inherit;
        vertical-align: bottom;
        background-color: #276696;
        color: #fff;
        transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms;
        overflow: hidden;
        text-align: center;
        float: right;
        text-align: right;
        margin-top: 1rem;
        bottom: 1.5rem;
        right: 1.5rem;
        position: fixed;
        z-index: 1005;
        border-radius: 50%;
      "
    >
      New
    </button> -->

    <button [matMenuTriggerFor]="menu" class="custom-mat-fab">
      {{ 'New' | translate }}
    </button>

    <mat-menu #menu="matMenu">
      <!-- <button mat-menu-item (click)="openUploadingPage($event)">
        Bulk (Uploading)
      </button> -->
      <button mat-menu-item [routerLink]="'/user-accounts/request'">
        {{ 'Request' | translate }}
      </button>
    </mat-menu>
  </div>
</div>
