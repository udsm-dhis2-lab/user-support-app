<div class="w-100 pl-2 pr-2" *ngIf="{
    configurations: configurations$ | async,
    selectedLanguageTranslations: selectedLanguageTranslations$ | async,
    translations: translations$ | async
  } as params">
  <div class="h3">{{params?.translations['Settings']}}</div>
  <mat-progress-bar mode="indeterminate" *ngIf="!params?.configurations"></mat-progress-bar>
  <div class="row" *ngIf="params?.configurations && !params?.configurations?.error">
    <div class="col-md-6 col-sm-12 col-sx-12">
      <mat-card class="mb-3">
        <mat-card-header>
          <mat-card-title>User roles</mat-card-title>
          <mat-card-subtitle></mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div class="w-100">
            <div class="loading-overlay" *ngIf="saving">
              <div class="text-center">
                <div>{{ 'Saving' | translate }} ....</div>
                <div class="mt-3 d-flex justify-content-center w-100">
                  <mat-spinner diameter="50" strokeWidth="2"></mat-spinner>
                </div>
              </div>
            </div>
            <table *ngIf="!saving" mat-table [dataSource]="params?.configurations?.allowedUserRolesForRequest">
              <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef>Name</th>
                <td mat-cell *matCellDef="let element">{{ element?.name }}</td>
              </ng-container>

              <ng-container matColumnDef="associatedRoles">
                <th mat-header-cell *matHeaderCellDef>Roles</th>
                <td mat-cell *matCellDef="let element">
                  {{ element?.associatedRoles?.length }}
                </td>
              </ng-container>

              <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef>Actions</th>
                <td mat-cell *matCellDef="let element">
                  <div class="actions">
                    <button mat-icon-button [matMenuTriggerFor]="actionsMenu" class="icon-button">
                      <mat-icon>more_vert</mat-icon>
                    </button>
                    <mat-menu #actionsMenu="matMenu">
                      <button (click)="
                          onEdit(element, params?.configurations, 'role')
                        " mat-menu-item>
                        <mat-icon>edit</mat-icon>
                        Edit
                      </button>
                      <button mat-menu-item (click)="
                          onDelete(element, params?.configurations, role)
                        ">
                        <mat-icon>delete</mat-icon>
                        Delete
                      </button>
                    </mat-menu>
                  </div>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="['name', 'associatedRoles', 'actions']"></tr>
              <tr mat-row *matRowDef="
                  let row;
                  columns: ['name', 'associatedRoles', 'actions']
                "></tr>
            </table>
          </div>
        </mat-card-content>
        <mat-card-actions align="end">
          <button mat-icon-button (click)="onAddNewRole($event, params?.configurations)">
            <mat-icon>add</mat-icon>
          </button>
        </mat-card-actions>
      </mat-card>
      <mat-card class="mb-3">
        <mat-card-header>
          <mat-card-title>Titles</mat-card-title>
          <mat-card-subtitle></mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div class="w-100">
            <table class="table">
              <tbody>
                <tr *ngFor="let title of params?.configurations?.referenceTitles">
                  <td>
                    {{ title?.name }}
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </mat-card-content>
        <mat-card-actions> </mat-card-actions>
      </mat-card>
    </div>
    <div class="col-md-6 col-sm-12 col-sx-12">
      <mat-card class="mb-3">
        <mat-card-header>
          <mat-card-title>User groups</mat-card-title>
          <mat-card-subtitle></mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div class="w-100">
            <table mat-table [dataSource]="params?.configurations?.allowedUserGroupsForRequest">
              <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef>Name</th>
                <td mat-cell *matCellDef="let element">{{ element?.name }}</td>
              </ng-container>

              <!-- Name Column -->
              <ng-container matColumnDef="associatedGroups">
                <th mat-header-cell *matHeaderCellDef>Groups</th>
                <td mat-cell *matCellDef="let element">
                  {{ element?.associatedGroups?.length }}
                </td>
              </ng-container>

              <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef>Actions</th>
                <td mat-cell *matCellDef="let element">
                  <div class="actions">
                    <button mat-icon-button [matMenuTriggerFor]="actionsMenu" class="icon-button">
                      <mat-icon>more_vert</mat-icon>
                    </button>
                    <mat-menu #actionsMenu="matMenu">
                      <button (click)="
                          onEdit(element, params?.configurations, 'group')
                        " mat-menu-item>
                        <mat-icon>edit</mat-icon>
                        Edit
                      </button>
                      <button mat-menu-item (click)="
                          onDelete(element, params?.configurations, 'group')
                        ">
                        <mat-icon>delete</mat-icon>
                        Delete
                      </button>
                    </mat-menu>
                  </div>
                </td>
              </ng-container>
              <tr mat-header-row *matHeaderRowDef="['name', 'associatedGroups', 'actions']"></tr>
              <tr mat-row *matRowDef="
                  let row;
                  columns: ['name', 'associatedGroups', 'actions']
                "></tr>
            </table>
          </div>
        </mat-card-content>
        <mat-card-actions align="end">
          <button mat-icon-button (click)="onAddNewGroup($event, params?.configurations)">
            <mat-icon>add</mat-icon>
          </button>
        </mat-card-actions>
      </mat-card>

      <mat-card class="mb-3">
        <mat-card-header class="mb-3">
          <mat-card-title>Translations</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="row">
            <div class="col-md-6 col-sm-12 col-sx-12">
              <mat-form-field>
                <mat-label>Languages</mat-label>
                <mat-select (selectionChange)="getSelectedLanguage($event)">
                  <mat-option *ngFor="let language of params?.configurations?.languages" [value]="language">{{
                    language?.name }}</mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <div class="col-md-6 col-sm-12 col-sx-12 d-flex justify-content-end">
              <button mat-stroked-button (click)="openDialog()">
                New language
              </button>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
      <mat-card class="mb-3" *ngIf="selectedLanguage">

        
        
        <mat-card-content>
          <div class="w-100" style="height: 1000px; overflow: auto">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>Keyword</th>
                  <th>Translation</th>
                </tr>
              </thead>

              <tbody>
                <tr *ngFor="
                let keyword of params?.configurations?.translationKeywords
              ">
                  <td>
                    {{ keyword }}
                  </td>
                  <td>
                    <app-capture-translation *ngIf="params?.selectedLanguageTranslations"
                      [translation]="params?.selectedLanguageTranslations[keyword]"
                      (translationValue)="getTranslationValue($event, keyword)"
                      (updatedValue)="getUpdatedValue($event, keyword)"></app-capture-translation>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
  <div class="alert alert-warning" role="alert" *ngIf="params?.configurations && params?.configurations?.error">
    {{ params?.configurations?.error?.httpStatusCode }}
    {{ params?.configurations?.error?.httpStatus }}
  </div>
</div>